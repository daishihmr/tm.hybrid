/*
The MIT License (MIT)

Copyright (c) 2015 daishi_hmr

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
!function(){function a(a){return"set"+a[0].toUpperCase()+a.substring(1)}tm.define("tm.hybrid.DelegateUtil",{init:function(a){this.type=a},property:function(b,c){c?this.type.prototype.accessor(b,{get:function(){return this.threeObject[c][b]},set:function(a){this.threeObject[c][b]=a}}):this.type.prototype.accessor(b,{get:function(){return this.threeObject[b]},set:function(a){this.threeObject[b]=a}}),this.type.defineInstanceMethod(a(b),function(a){return this[b]=a,this})},method:function(a,b,c){c?this.type.defineInstanceMethod(a,function(){var d=this.threeObject[c][a].apply(this.threeObject[c],arguments);return b?this:d}):this.type.defineInstanceMethod(a,function(){var c=this.threeObject[a].apply(this.threeObject,arguments);return b?this:c})}})}(),function(){tm.define("tm.hybrid.ThreeElement",{superClass:"tm.app.Element",init:function(a){this.superInit(),this.threeObject=a||new THREE.Object3D},addChild:function(a){a.parent&&a.remove(),a.parent=this,this.children.push(a),a instanceof tm.hybrid.ThreeElement&&this.threeObject.add(a.threeObject);var b=tm.event.Event("added");return a.dispatchEvent(b),a},removeChild:function(a){var b=this.children.indexOf(a);if(-1!=b){this.children.splice(b,1),a instanceof tm.hybrid.ThreeElement&&this.threeObject.remove(a.threeObject);var c=tm.event.Event("removed");a.dispatchEvent(c)}},setPosition:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},ahead:function(a){return this.threeObject.position.add(this.forwardVector.multiplyScalar(a)),this},sideStep:function(a){return this.threeObject.position.add(this.sidewardVector.multiplyScalar(a)),this},elevate:function(a){return this.threeObject.position.add(this.upwardVector.multiplyScalar(a)),this},setRotation:function(a,b,c){return this.rotationX=a,this.rotationY=b,this.rotationZ=c,this},setRotationX:function(a){return this.rotationX=a,this},setRotationY:function(a){return this.rotationY=a,this},setRotationZ:function(a){return this.rotationZ=a,this},rotatePitch:function(b){var c=d.setFromAxisAngle(a,b*Math.DEG_TO_RAD);return this.quaternion.multiply(c),this},rotateYaw:function(a){var c=d.setFromAxisAngle(b,a*Math.DEG_TO_RAD);return this.quaternion.multiply(c),this},rotateRoll:function(a){var b=d.setFromAxisAngle(c,a*Math.DEG_TO_RAD);return this.quaternion.multiply(b),this},setScale:function(a,b,c){return 1===arguments.length&&(b=a,c=a),this.scaleX=a,this.scaleY=b,this.scaleZ=c,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this}});var a=new THREE.Vector3(1,0,0),b=new THREE.Vector3(0,1,0),c=new THREE.Vector3(0,0,1),d=new THREE.Quaternion,e=tm.hybrid.DelegateUtil(tm.hybrid.ThreeElement);e.property("id"),e.property("uuid"),e.property("name"),tm.hybrid.ThreeElement.prototype.accessor("position",{get:function(){return this.threeObject.position},set:function(a){this.threeObject.position=a}}),e.property("x","position"),e.property("y","position"),e.property("z","position"),tm.hybrid.ThreeElement.prototype.accessor("scale",{get:function(){return this.threeObject.scale},set:function(a){this.threeObject.scale=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleX",{get:function(){return this.threeObject.scale.x},set:function(a){this.threeObject.scale.x=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleY",{get:function(){return this.threeObject.scale.y},set:function(a){this.threeObject.scale.y=a}}),tm.hybrid.ThreeElement.prototype.accessor("scaleZ",{get:function(){return this.threeObject.scale.z},set:function(a){this.threeObject.scale.z=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotation",{get:function(){return this.threeObject.rotation},set:function(a){this.threeObject.rotation=a}}),tm.hybrid.ThreeElement.prototype.accessor("rotationX",{get:function(){return this.threeObject.rotation.x*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.x=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.accessor("rotationY",{get:function(){return this.threeObject.rotation.y*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.y=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.accessor("rotationZ",{get:function(){return this.threeObject.rotation.z*Math.RAD_TO_DEG},set:function(a){this.threeObject.rotation.z=a*Math.DEG_TO_RAD}}),tm.hybrid.ThreeElement.prototype.getter("forwardVector",function(){return null==this._forwardVector&&(this._forwardVector=new THREE.Vector3),this._forwardVector.set(0,0,1),this._forwardVector.applyQuaternion(this.quaternion),this._forwardVector}),tm.hybrid.ThreeElement.prototype.getter("sidewardVector",function(){return null==this._sidewardVector&&(this._sidewardVector=new THREE.Vector3),this._sidewardVector.set(1,0,0),this._sidewardVector.applyQuaternion(this.quaternion),this._sidewardVector}),tm.hybrid.ThreeElement.prototype.getter("upwardVector",function(){return null==this._upVector&&(this._upVector=new THREE.Vector3),this._upVector.set(0,1,0),this._upVector.applyQuaternion(this.quaternion),this._upVector}),e.property("up"),e.property("quaternion"),e.property("visible"),e.property("castShadow"),e.property("receiveShadow"),e.property("frustumCulled"),e.property("matrixAutoUpdate"),e.property("matrixWorldNeedsUpdate"),e.property("rotationAutoUpdate"),e.property("userData"),e.property("matrixWorld"),e.method("applyMatrix",!0),e.method("translateX",!0),e.method("translateY",!0),e.method("translateZ",!0),e.method("localToWorld"),e.method("worldToLocal"),e.method("lookAt",!0),e.method("traverse",!0),e.method("traverseVisible",!0),e.method("traverseAncestors",!0),e.method("updateMatrix",!0),e.method("updateMatrixWorld",!0),e.method("getObjectByName"),e.method("rotateOnAxis",!0),tm.hybrid.ThreeElement.prototype.localToGlobal=tm.hybrid.ThreeElement.prototype.localToWorld,tm.hybrid.ThreeElement.prototype.globalToLocal=tm.hybrid.ThreeElement.prototype.worldToLocal}(),function(){tm.define("tm.hybrid.Mesh",{superClass:"tm.hybrid.ThreeElement",init:function(a){if("string"==typeof a){var b=tm.asset.Manager.get(a);if(b){if(b instanceof tm.asset.ThreeJSON)this.superInit(b.mesh.clone());else if(b instanceof tm.asset.Vox)this.superInit(b.mesh.clone());else if(b instanceof tm.asset.MQO){this.superInit(b.model.meshes[0]);for(var c=1;c<b.model.meshes.length;c++)tm.hybrid.Mesh(b.model.meshes[c]).addChildTo(this)}}else console.error("アセット'{0}'がないよ".format(a))}else a instanceof THREE.Mesh?this.superInit(a):a instanceof THREE.Geometry?arguments.length>=2?this.superInit(new THREE.Mesh(a,arguments[1])):this.superInit(new THREE.Mesh(a)):this.superInit(new THREE.Mesh)}});var a=tm.hybrid.DelegateUtil(tm.hybrid.Mesh);a.property("geometry"),a.property("material"),a.method("getMorphTargetIndexByName",!0),a.method("updateMorphTargets",!0)}(),function(){tm.define("tm.hybrid.Camera",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(new THREE.PerspectiveCamera(45,1,1,2e4))},isInSight:function(b){return a.setFromMatrixPosition(b.matrixWorld).project(this),-1<=a.x&&a.x<=1&&-1<=a.y&&a.y<=1}});var a=new THREE.Vector3,b=tm.hybrid.DelegateUtil(tm.hybrid.Camera);b.property("matrixWorldInverse"),b.property("projectionMatrix"),tm.hybrid.Camera.prototype.accessor("fov",{get:function(){return this.threeObject.fov},set:function(a){this.threeObject.fov=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.defineInstanceMethod("setFov",function(a){return this.fov=a,this}),tm.hybrid.Camera.prototype.accessor("aspect",{get:function(){return this.threeObject.aspect},set:function(a){this.threeObject.aspect=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.defineInstanceMethod("setAspect",function(a){return this.aspect=a,this}),tm.hybrid.Camera.prototype.accessor("near",{get:function(){return this.threeObject.near},set:function(a){this.threeObject.near=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.defineInstanceMethod("setNear",function(a){return this.near=a,this}),tm.hybrid.Camera.prototype.accessor("far",{get:function(){return this.threeObject.far},set:function(a){this.threeObject.far=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.Camera.defineInstanceMethod("setFar",function(a){return this.far=a,this})}(),function(){tm.define("tm.hybrid.OrthoCamera",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(new THREE.OrthographicCamera(-.5,.5,.5,-.5,1,1e4))}}),tm.hybrid.OrthoCamera.prototype.accessor("left",{get:function(){return this.threeObject.left},set:function(a){this.threeObject.left=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.OrthoCamera.prototype.accessor("right",{get:function(){return this.threeObject.right},set:function(a){this.threeObject.right=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.OrthoCamera.prototype.accessor("top",{get:function(){return this.threeObject.top},set:function(a){this.threeObject.top=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.OrthoCamera.prototype.accessor("bottom",{get:function(){return this.threeObject.bottom},set:function(a){this.threeObject.bottom=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.OrthoCamera.prototype.accessor("near",{get:function(){return this.threeObject.near},set:function(a){this.threeObject.near=a,this.threeObject.updateProjectionMatrix()}}),tm.hybrid.OrthoCamera.prototype.accessor("far",{get:function(){return this.threeObject.far},set:function(a){this.threeObject.far=a,this.threeObject.updateProjectionMatrix()}})}(),function(){tm.define("tm.hybrid.PlaneMesh",{superClass:"tm.hybrid.Mesh",init:function(a,b){a={}.$extend(tm.hybrid.PlaneMesh.DEFAULT_GEOMETRY_PARAM,a),b={}.$extend(tm.hybrid.PlaneMesh.DEFAULT_MATERIAL_PARAM,b);var c=new THREE.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments),d=new THREE.MeshPhongMaterial(b);this.superInit(new THREE.Mesh(c,d))}}),tm.hybrid.PlaneMesh.DEFAULT_GEOMETRY_PARAM={width:1,height:1,widthSegments:1,heightSegments:1},tm.hybrid.PlaneMesh.DEFAULT_MATERIAL_PARAM={color:16777215},tm.define("tm.hybrid.BoxMesh",{superClass:"tm.hybrid.Mesh",init:function(a,b){a={}.$extend(tm.hybrid.BoxMesh.DEFAULT_GEOMETRY_PARAM,a),b={}.$extend(tm.hybrid.BoxMesh.DEFAULT_MATERIAL_PARAM,b);var c=new THREE.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments),d=new THREE.MeshPhongMaterial(b);this.superInit(new THREE.Mesh(c,d))}}),tm.hybrid.BoxMesh.DEFAULT_GEOMETRY_PARAM={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1},tm.hybrid.BoxMesh.DEFAULT_MATERIAL_PARAM={color:16777215}}(),function(){tm.define("tm.hybrid.Sprite",{superClass:"tm.hybrid.ThreeElement",init:function(a,b,c){var d=null,e=null;if("string"==typeof a?(d=a,e=tm.hybrid.Sprite.materialCache[a],e||(a=tm.asset.Manager.get(a),a||console.error("アセット{0}がないよ".format(a)))):(a.id||(a.id=THREE.Math.generateUUID()),d=a.id),!e){var f=new THREE.Texture(a.element);f.needsUpdate=!0,e=new THREE.SpriteMaterial({map:f,color:16777215,fog:!0}),tm.hybrid.Sprite.materialCache[d]=e}b=b||1,c=c||1,this.superInit(new THREE.Sprite(e))}}),tm.hybrid.Sprite.materialCache={}}(),function(){tm.hybrid=tm.hybrid||{},tm.hybrid.Texture=function(a,b){"string"==typeof a?a=tm.asset.Manager.get(a).element:(a instanceof tm.graphics.Canvas||a instanceof tm.asset.Texture)&&(a=a.element);var c=new THREE.Texture(a,b);return c.needsUpdate=!0,c}}(),function(){tm.define("tm.hybrid.Scene",{superClass:"tm.app.Scene",two:null,three:null,effectComposer:null,init:function(){this.superInit(),this.two=this,this.three=tm.hybrid.Scene.Three(),this.effectComposer=null,this.on("enter",function(a){this.camera.aspect=a.app.width/a.app.height})},render:function(a){this.effectComposer&&this.effectComposer.passes.length>1?this.effectComposer.render():a.render(this.three.scene,this.three.camera.threeObject)},addChild:function(a){a instanceof tm.hybrid.ThreeElement?this.three.addChild(a):tm.app.Scene.prototype.addChild.call(this,a)},removeChild:function(a){a instanceof tm.hybrid.ThreeElement?this.three.removeChild(a):tm.app.Scene.prototype.removeChild.call(this,a)},enableEffectComposer:function(){if(THREE.EffectComposer&&THREE.RenderPass){var a=new THREE.WebGLRenderTarget(this.app.width,this.app.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1}),b=new THREE.RenderPass(this.three.scene,this.three.camera.threeObject);return this.effectComposer=new THREE.EffectComposer(this.app.threeRenderer,a),this.effectComposer.addPass(b),!0}return!1}}),tm.hybrid.Scene.prototype.accessor("camera",{get:function(){return this.three.camera},set:function(a){this.three.camera=a}}),tm.hybrid.Scene.prototype.getCamera=function(){return this.camera},tm.hybrid.Scene.prototype.setCamera=function(a){return this.camera=a,this},tm.hybrid.Scene.prototype.accessor("ambientLight",{get:function(){return this.three.ambientLight},set:function(a){this.three.ambientLight=a}}),tm.hybrid.Scene.prototype.getAmbientLight=function(){return this.ambientLight},tm.hybrid.Scene.prototype.setAmbientLight=function(a){return this.ambientLight=a,this},tm.hybrid.Scene.prototype.accessor("directionalLight",{get:function(){return this.three.directionalLight},set:function(a){this.three.directionalLight=a}}),tm.hybrid.Scene.prototype.getDirectionalLight=function(){return this.directionalLight},tm.hybrid.Scene.prototype.setDirectionalLight=function(a){return this.directionalLight=a,this},tm.hybrid.Scene.prototype.accessor("fog",{get:function(){return this.three.scene.fog},set:function(a){this.three.scene.fog=a}}),tm.hybrid.Scene.prototype.isFog=function(){return this.fog},tm.hybrid.Scene.prototype.setFog=function(a){return this.fog=a,this},tm.hybrid.Scene.prototype.accessor("fogColor",{get:function(){return this.three.scene.fog.color},set:function(a){this.three.scene.fog.color=a}}),tm.hybrid.Scene.prototype.getFogColor=function(){return this.fogColor},tm.hybrid.Scene.prototype.setFogColor=function(a){return this.fogColor=a,this},tm.hybrid.Scene.prototype.accessor("fogNear",{get:function(){return this.three.scene.fog.near},set:function(a){this.three.scene.fog.near=a}}),tm.hybrid.Scene.prototype.getFogNear=function(){return this.fogNear},tm.hybrid.Scene.prototype.setFogNear=function(a){return this.fogNear=a,this},tm.hybrid.Scene.prototype.accessor("fogFar",{get:function(){return this.three.scene.fog.far},set:function(a){this.three.scene.fog.far=a}}),tm.hybrid.Scene.prototype.getFogFar=function(){return this.fogFar},tm.hybrid.Scene.prototype.setFogFar=function(a){return this.fogFar=a,this},tm.hybrid.Scene.prototype.accessor("overrideMaterial",{get:function(){return this.three.scene.overrideMaterial},set:function(a){this.three.scene.overrideMaterial=a}}),tm.hybrid.Scene.prototype.getOverrideMaterial=function(){return this.overrideMaterial},tm.hybrid.Scene.prototype.setOverrideMaterial=function(a){return this.overrideMaterial=a,this},tm.hybrid.Scene.prototype.accessor("autoUpdate",{get:function(){return this.three.scene.autoUpdate},set:function(a){this.three.scene.autoUpdate=a}}),tm.hybrid.Scene.prototype.isAutoUpdate=function(){return this.autoUpdate},tm.hybrid.Scene.prototype.setAutoUpdate=function(a){return this.autoUpdate=a,this},tm.define("tm.hybrid.Scene.Three",{superClass:"tm.hybrid.ThreeElement",init:function(){this.superInit(new THREE.Scene),this.scene=this.threeObject,this.scene.fog=new THREE.Fog(16777215,1e3,5e3),this.camera=tm.hybrid.Camera(),this.camera.z=7,this.ambientLight=tm.hybrid.AmbientLight(8947848).addChildTo(this),this.directionalLight=tm.hybrid.DirectionalLight(16777215,1).setPosition(1,1,1).addChildTo(this)}})}();var tm=tm||{};tm.hybrid=tm.hybrid||{},function(){tm.define("tm.hybrid.Application",{superClass:"tm.display.CanvasApp",threeRenderer:null,threeCanvas:null,init:function(a,b){this.superInit(a),this.setupThree(b),this.background="transparent",this.replaceScene(tm.hybrid.Scene())},setupThree:function(a){var b={antialias:!0};a&&(a instanceof HTMLCanvasElement?b.canvas=a:"string"==typeof a&&(b.canvas=document.querySelector(a))),this.threeRenderer=new THREE.WebGLRenderer(b),this.threeRenderer.setClearColor("0x000000"),this.threeCanvas=this.threeRenderer.domElement},fitWindow:function(a){var b=function(){a=void 0===a?!0:a;var b=this.threeCanvas,c=b.style;c.position="absolute",c.margin="auto",c.left="0px",c.top="0px",c.bottom="0px",c.right="0px";var d=b.width/window.innerWidth,e=b.height/window.innerHeight,f=b.height/b.width;d>e?(c.width=innerWidth+"px",c.height=innerWidth*f+"px"):(c.width=innerHeight/f+"px",c.height=innerHeight+"px")}.bind(this);return b(),a&&window.addEventListener("resize",b,!1),tm.display.CanvasApp.prototype.fitWindow.call(this,a)},_update:function(){tm.app.CanvasApp.prototype._update.call(this);var a=this.currentScene;this.awake&&a instanceof tm.hybrid.Scene&&(this.updater.update(a.three.camera),this.updater.update(a.three))},_draw:function(){tm.display.CanvasApp.prototype._draw.call(this);var a=this.currentScene;a instanceof tm.hybrid.Scene&&a.render(this.threeRenderer)},resize:function(a,b){this.threeRenderer.setSize(a,b);var c=this.currentScene;return c instanceof tm.hybrid.Scene&&(c.three.camera.aspect=a/b),tm.display.CanvasApp.prototype.resize.call(this,a,b)}})}(),function(){tm.hybrid=tm.hybrid||{},tm.hybrid.ColorConverter={hsl:function(a,b,c){if(1===arguments.length&&"string"==typeof arguments[0]){var d=arguments[0].split(" ").join("").match(/hsl\((\d+),(\d+)%,(\d+)%\)/);if(!d)throw new Error("invalid argument "+arguments[0]);a=d[1],b=d[2],c=d[3]}return(new THREE.Color).setHSL(a/360,b/100,c/100).getHex()}}}(),function(){tm.define("tm.hybrid.AmbientLight",{superClass:"tm.hybrid.ThreeElement",init:function(a){a=a||16777215,this.superInit(new THREE.AmbientLight(a))}});var a=tm.hybrid.DelegateUtil(tm.hybrid.AmbientLight);a.property("color")}(),function(){tm.define("tm.hybrid.DirectionalLight",{superClass:"tm.hybrid.ThreeElement",init:function(a,b){a=a||16777215,b=b||1,this.superInit(new THREE.DirectionalLight(a,b))}});var a=tm.hybrid.DelegateUtil(tm.hybrid.DirectionalLight);a.property("target"),a.property("intensity"),a.property("onlyShadow"),a.property("shadowCameraNear"),a.property("shadowCameraFar"),a.property("shadowCameraLeft"),a.property("shadowCameraRight"),a.property("shadowCameraTop"),a.property("shadowCameraBottom"),a.property("shadowCameraVisible"),a.property("shadowBias"),a.property("shadowDarkness"),a.property("shadowMapWidth"),a.property("shadowMapHeight"),a.property("shadowCascade"),a.property("shadowCascadeOffset"),a.property("shadowCascadeCount"),a.property("shadowCascadeBias"),a.property("shadowCascadeWidth"),a.property("shadowCascadeHeight"),a.property("shadowCascadeNearZ"),a.property("shadowCascadeFarZ"),a.property("shadowCascadeArray"),a.property("shadowMap"),a.property("shadowMapSize"),a.property("shadowCamera"),a.property("shadowMatrix")}(),function(){tm.hybrid=tm.hybrid||{},tm.hybrid.Utils={}}(),function(){tm.hybrid=tm.hybrid||{},tm.hybrid.EffectModules=["postprocessing/AdaptiveToneMappingPass","postprocessing/BloomPass","postprocessing/BokehPass","postprocessing/DotScreenPass","postprocessing/EffectComposer","postprocessing/FilmPass","postprocessing/GlitchPass","postprocessing/MaskPass","postprocessing/RenderPass","postprocessing/SavePass","postprocessing/ShaderPass","postprocessing/TexturePass","shaders/BasicShader","shaders/BleachBypassShader","shaders/BlendShader","shaders/BokehShader","shaders/BokehShader2","shaders/BrightnessContrastShader","shaders/ColorCorrectionShader","shaders/ColorifyShader","shaders/ConvolutionShader","shaders/CopyShader","shaders/DOFMipMapShader","shaders/DigitalGlitch","shaders/DotScreenShader","shaders/EdgeShader","shaders/EdgeShader2","shaders/FXAAShader","shaders/FilmShader","shaders/FocusShader","shaders/FresnelShader","shaders/HorizontalBlurShader","shaders/HorizontalTiltShiftShader","shaders/HueSaturationShader","shaders/KaleidoShader","shaders/LuminosityShader","shaders/MirrorShader","shaders/NormalDisplacementShader","shaders/NormalMapShader","shaders/OceanShaders","shaders/ParallaxShader","shaders/RGBShiftShader","shaders/SSAOShader","shaders/SepiaShader","shaders/TechnicolorShader","shaders/ToneMapShader","shaders/TriangleBlurShader","shaders/UnpackDepthRGBAShader","shaders/VerticalBlurShader","shaders/VerticalTiltShiftShader","shaders/VignetteShader"].reduce(function(a,b){var c="https://cdn.rawgit.com/mrdoob/three.js/r71/examples/js/"+b+".js";return a[c]=c,a},{})}(),function(){tm.geom.Vector2.prototype.toThree=function(){return new THREE.Vector2(this.x,this.y)},THREE.Vector2.prototype.toTm=function(){return tm.geom.Vector2(this.x,this.y)},tm.geom.Vector3.prototype.toThree=function(){return new THREE.Vector3(this.x,this.y,this.z)},THREE.Vector3.prototype.toTm=function(){return tm.geom.Vector3(this.x,this.y,this.z)},tm.geom.Matrix33.prototype.toThree=function(){return new THREE.Matrix3(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)},THREE.Matrix3.prototype.toTm=function(){var a=this.elements;return tm.geom.Matrix33(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])},tm.geom.Matrix44.prototype.toThree=function(){return new THREE.Matrix4(this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33)},THREE.Matrix4.prototype.toTm=function(){var a=this.elements;return tm.geom.Matrix44(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}}(),function(){tm.define("tm.hybrid.ParticleSystem",{superClass:"tm.hybrid.ThreeElement",init:function(a){this.param={}.$extend(tm.hybrid.ParticleSystem.DEFAULT_PARAM,a),this.geometry=this._createGeometry(this.param),this.material=this._createMaterial(this.param),this.superInit(new THREE.PointCloud(this.geometry,this.material)),this.particles=[];for(var b=0;b<this.param.count;b++)this.particles.push({startTime:0,endTime:-1,positionFrom:[0,1e4,0],positionTo:[0,1e4,0],index:b});this.now=0,this.needsUpdate=!1},_createGeometry:function(a){for(var b=new THREE.BufferGeometry,c=a.count,d=new Float32Array(c),e=new Float32Array(c),f=new Float32Array(3*c),g=new Float32Array(3*c),h=(new Int32Array(c),new Float32Array(3*c)),i=new Float32Array(3*c),j=new Float32Array(3*c),k=new Float32Array(3*c),l=new Float32Array(3*c),m=new Float32Array(3*c),n=(new Float32Array(c),new THREE.Vector3,0);c>n;n++)d[n]=0,e[n]=-1,f[3*n+0]=0,f[3*n+1]=0,f[3*n+2]=0,g[3*n+0]=0,g[3*n+1]=0,g[3*n+2]=0,h[3*n+0]=a.sizeFrom,h[3*n+1]=a.sizeTo,h[3*n+2]=a.sizeDuration,i[3*n+0]=a.texRotFrom,i[3*n+1]=a.texRotTo,i[3*n+2]=a.texRotDuration,j[3*n+0]=a.redFrom,j[3*n+1]=a.redTo,j[3*n+2]=a.redDuration,k[3*n+0]=a.greenFrom,k[3*n+1]=a.greenTo,k[3*n+2]=a.greenDuration,l[3*n+0]=a.blueFrom,l[3*n+1]=a.blueTo,l[3*n+2]=a.blueDuration,m[3*n+0]=a.alphaFrom,m[3*n+1]=a.alphaTo,m[3*n+2]=a.alphaDuration;return b.addAttribute("startTime",new THREE.BufferAttribute(d,1)),b.addAttribute("endTime",new THREE.BufferAttribute(e,1)),b.addAttribute("position",new THREE.BufferAttribute(f,3)),b.addAttribute("positionTo",new THREE.BufferAttribute(g,3)),b.addAttribute("sizeInfo",new THREE.BufferAttribute(h,3)),b.addAttribute("texRotInfo",new THREE.BufferAttribute(i,3)),b.addAttribute("redInfo",new THREE.BufferAttribute(j,3)),b.addAttribute("greenInfo",new THREE.BufferAttribute(k,3)),b.addAttribute("blueInfo",new THREE.BufferAttribute(l,3)),b.addAttribute("alphaInfo",new THREE.BufferAttribute(m,3)),b},_createMaterial:function(a){var b=new THREE.ShaderMaterial({vertexShader:f,fragmentShader:g,attributes:{startTime:{type:"f",value:null},endTime:{type:"f",value:null},positionTo:{type:"v3",value:null},sizeInfo:{type:"v3",value:null},texRotInfo:{type:"v3",value:null},redInfo:{type:"v3",value:null},greenInfo:{type:"v3",value:null},blueInfo:{type:"v3",value:null},alphaInfo:{type:"v3",value:null}},uniforms:{texture:{type:"t",value:a.texture},now:{type:"f",value:0},positionEasing:{type:"i",value:a.easing},sizeEasing:{type:"i",value:a.sizeEasing},texRotEasing:{type:"i",value:a.texRotEasing},redEasing:{type:"i",value:a.redEasing},greenEasing:{type:"i",value:a.greenEasing},blueEasing:{type:"i",value:a.blueEasing},alphaEasing:{type:"i",value:a.alphaEasing}},blending:a.blending,depthTest:!1,depthWrite:!1,transparent:!0});return b},update:function(a){this.now+=.001,this._checkEnd(),this.needsUpdate&&(this._setAttributes(),this.needsUpdate=!1),this._setUniforms()},_checkEnd:function(){for(var a=this.particles,b=a.length-1;b>=0;b--){var c=a[b];0<c.endTime&&c.endTime<this.now&&(c.startTime=0,c.endTime=-1,c.positionFrom=[0,1e4,0],c.positionTo=[0,1e4,0],this.needsUpdate=!0)}},_setAttributes:function(){var a=this.particles,b=this.geometry,c=b.getAttribute("startTime"),d=b.getAttribute("endTime"),e=b.getAttribute("position"),f=b.getAttribute("positionTo");c.needsUpdate=!0,d.needsUpdate=!0,e.needsUpdate=!0,f.needsUpdate=!0;for(var g=0,h=a.length;h>g;g++){var i=a[g],j=i.index;c.array[j]=i.startTime,d.array[j]=i.endTime;var k=i.positionFrom,l=i.positionTo;e.array[3*j+0]=k[0],e.array[3*j+1]=k[1],e.array[3*j+2]=k[2],f.array[3*j+0]=l[0],f.array[3*j+1]=l[1],f.array[3*j+2]=l[2]}},_setUniforms:function(){var a=this.material.uniforms;a.now.value=this.now},createEmitter:function(){return tm.hybrid.ParticleEmitter(this,this.param.emitterLife,this.param.emitPerFrame,this.param.emitterDamping).addChildTo(this.parent)},_emit:function(c){for(var d=this.param,e=this.particles,f=0,g=this.particles.length;g>f&&!(e[f].endTime<this.now);f++);if(f!==g){var h=e[f];h.startTime=this.now,0!==d.lifeRandom?h.endTime=this.now+d.life*Math.randf(1-d.lifeRandom,1+d.lifeRandom)*.001:h.endTime=this.now+.001*d.life,0!==d.emitRange?(b(),a.setLength(Math.randf(0,d.emitRange)),h.positionFrom=[c.x+a.x,c.y+a.y,c.z+a.z]):h.positionFrom=[c.x,c.y,c.z],null!==d.direction?a.set(d.direction):(b(),a.normalize()),0!==d.distanceRandom?a.setLength(d.distance*Math.randf(1-d.distanceRandom,1+d.distanceRandom)):a.setLength(d.distance),h.positionTo=[c.x+a.x,c.y+a.y,c.z+a.z],this.needsUpdate=!0}}});var a=new THREE.Vector3,b=function(){for(a.set(Math.randf(-1,1),Math.randf(-1,1),Math.randf(-1,1));a.lengthSq()>1;)a.set(Math.randf(-1,1),Math.randf(-1,1),Math.randf(-1,1));return a.normalize(),a},c=function(){var a=256,b=tm.graphics.Canvas().resize(a,a).setFillStyle(tm.graphics.RadialGradient(.5*a,.5*a,0,.5*a,.5*a,.5*a).addColorStopList([{offset:0,color:"hsla(  0,  80%, 100%, 1.0)"},{offset:.2,color:"hsla(  0,  80%, 100%, 1.0)"},{offset:1,color:"hsla(  0,  80%, 100%, 0.0)"}]).toStyle()).fillRect(0,0,a,a),c=new THREE.Texture(b.element);return c.needsUpdate=!0,c}(),d=tm.hybrid.ParticleSystem.easing={LINEAR:0,QUAD_IN:1,QUAD_OUT:2,QUAD_IN_OUT:3,CUBIC_IN:4,CUBIC_OUT:5,CUBIC_IN_OUT:6,QUARTIC_IN:7,QUARTIC_OUT:8,QUARTIC_IN_OUT:9,QINTIC_IN:10,QINTIC_OUT:11,QINTIC_IN_OUT:12,SINE_IN:13,SINE_OUT:14,SINE_IN_OUT:15,EXPONENTIAL_IN:16,EXPONENTIAL_OUT:17,EXPONENTIAL_IN_OUT:18,CIRCULAR_IN:19,CIRCULAR_OUT:20,CIRCULAR_IN_OUT:21,ELASTIC_IN:22,ELASTIC_OUT:23,ELASTIC_IN_OUT:24,BACK_IN:25,BACK_OUT:26,BACK_IN_OUT:27,BOUNCE_OUT:28,BOUNCE_IN:29,BOUNCE_IN_OUT:30};tm.hybrid.ParticleSystem.DEFAULT_PARAM={emitterLife:1,emitPerFrame:1,emitterDamping:1,texture:c,count:1e4,life:60,lifeRandom:0,emitRange:0,direction:null,directionRandom:0,distance:1,distanceRandom:0,directionToRandom:0,easing:d.LINEAR,initialVelocity:null,acceleration:0,gravity:0,blending:THREE.AdditiveBlending,sizeFrom:1,sizeTo:1,sizeDuration:1,sizeEasing:d.LINEAR,texRotFrom:0,texRotTo:0,texRotDuration:0,texRotEasing:d.LINEAR,redFrom:1,redTo:1,redDuration:1,redEasing:d.LINEAR,greenFrom:1,greenTo:1,greenDuration:1,greenEasing:d.LINEAR,blueFrom:1,blueTo:1,blueDuration:1,blueEasing:d.LINEAR,alphaFrom:1,alphaTo:0,alphaDuration:1,alphaEasing:d.LINEAR},tm.define("tm.hybrid.ParticleEmitter",{superClass:tm.hybrid.ThreeElement,init:function(a,b,c,d){this.superInit(),this.particleSystem=a,this.life=b,this.epf=c,this.damping=d},update:function(a){for(var b=0;b<this.epf;b++)this.particleSystem._emit(this.position);this.life-=1,this.epf*=this.damping,this.life<=0&&this.remove()}});var e=["#ifndef LINEAR","#define LINEAR "+d.LINEAR,"#endif","#ifndef QUAD_IN","#define QUAD_IN "+d.QUAD_IN,"#endif","#ifndef QUAD_OUT","#define QUAD_OUT "+d.QUAD_OUT,"#endif","#ifndef QUAD_IN_OUT","#define QUAD_IN_OUT "+d.QUAD_IN_OUT,"#endif","#ifndef CUBIC_IN","#define CUBIC_IN "+d.CUBIC_IN,"#endif","#ifndef CUBIC_OUT","#define CUBIC_OUT "+d.CUBIC_OUT,"#endif","#ifndef CUBIC_IN_OUT","#define CUBIC_IN_OUT "+d.CUBIC_IN_OUT,"#endif","#ifndef QUARTIC_IN","#define QUARTIC_IN "+d.QUARTIC_IN,"#endif","#ifndef QUARTIC_OUT","#define QUARTIC_OUT "+d.QUARTIC_OUT,"#endif","#ifndef QUARTIC_IN_OUT","#define QUARTIC_IN_OUT "+d.QUARTIC_IN_OUT,"#endif","#ifndef QINTIC_IN","#define QINTIC_IN "+d.QINTIC_IN,"#endif","#ifndef QINTIC_OUT","#define QINTIC_OUT "+d.QINTIC_OUT,"#endif","#ifndef QINTIC_IN_OUT","#define QINTIC_IN_OUT "+d.QINTIC_IN_OUT,"#endif","#ifndef SINE_IN","#define SINE_IN "+d.SINE_IN,"#endif","#ifndef SINE_OUT","#define SINE_OUT "+d.SINE_OUT,"#endif","#ifndef SINE_IN_OUT","#define SINE_IN_OUT "+d.SINE_IN_OUT,"#endif","#ifndef EXPONENTIAL_IN","#define EXPONENTIAL_IN "+d.EXPONENTIAL_IN,"#endif","#ifndef EXPONENTIAL_OUT","#define EXPONENTIAL_OUT "+d.EXPONENTIAL_OUT,"#endif","#ifndef EXPONENTIAL_IN_OUT","#define EXPONENTIAL_IN_OUT "+d.EXPONENTIAL_IN_OUT,"#endif","#ifndef CIRCULAR_IN","#define CIRCULAR_IN "+d.CIRCULAR_IN,"#endif","#ifndef CIRCULAR_OUT","#define CIRCULAR_OUT "+d.CIRCULAR_OUT,"#endif","#ifndef CIRCULAR_IN_OUT","#define CIRCULAR_IN_OUT "+d.CIRCULAR_IN_OUT,"#endif","#ifndef ELASTIC_IN","#define ELASTIC_IN "+d.ELASTIC_IN,"#endif","#ifndef ELASTIC_OUT","#define ELASTIC_OUT "+d.ELASTIC_OUT,"#endif","#ifndef ELASTIC_IN_OUT","#define ELASTIC_IN_OUT "+d.ELASTIC_IN_OUT,"#endif","#ifndef BACK_IN","#define BACK_IN "+d.BACK_IN,"#endif","#ifndef BACK_OUT","#define BACK_OUT "+d.BACK_OUT,"#endif","#ifndef BACK_IN_OUT","#define BACK_IN_OUT "+d.BACK_IN_OUT,"#endif","#ifndef BOUNCE_OUT","#define BOUNCE_OUT "+d.BOUNCE_OUT,"#endif","#ifndef BOUNCE_IN","#define BOUNCE_IN "+d.BOUNCE_IN,"#endif","#ifndef BOUNCE_IN_OUT","#define BOUNCE_IN_OUT "+d.BOUNCE_IN_OUT,"#endif","#ifndef PI","#define PI 3.141592653589793","#endif","#ifndef HALF_PI","#define HALF_PI 1.5707963267948966","#endif","float easeInQuad(float t) {","  return t * t;","}","float easeOutQuad(float t) {","  return -t * (t - 2.0);","}","float easeInOutQuad(float t) {","  float p = 2.0 * t * t;","  return t < 0.5 ? p : -p + (4.0 * t) - 1.0;","}","float cubicIn(float t) {","  return t * t * t;","}","float cubicOut(float t) {","  float f = t - 1.0;","  return f * f * f + 1.0;","}","float cubicInOut(float t) {","  return t < 0.5","    ? 4.0 * t * t * t","    : 0.5 * pow(2.0 * t - 2.0, 3.0) + 1.0;","}","float quarticIn(float t) {","  return pow(t, 4.0);","}","float quarticOut(float t) {","  return pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;","}","float quarticInOut(float t) {","  return t < 0.5","    ? +8.0 * pow(t, 4.0)","    : -8.0 * pow(t - 1.0, 4.0) + 1.0;","}","float qinticIn(float t) {","  return pow(t, 5.0);","}","float qinticOut(float t) {","  return 1.0 - (pow(t - 1.0, 5.0));","}","float qinticInOut(float t) {","  return t < 0.5","    ? +16.0 * pow(t, 5.0)","    : -0.5 * pow(2.0 * t - 2.0, 5.0) + 1.0;","}","float sineIn(float t) {","  return sin((t - 1.0) * HALF_PI) + 1.0;","}","float sineOut(float t) {","  return sin(t * HALF_PI);","}","float sineInOut(float t) {","  return -0.5 * (cos(PI * t) - 1.0);","}","float exponentialIn(float t) {","  return t == 0.0 ? t : pow(2.0, 10.0 * (t - 1.0));","}","float exponentialOut(float t) {","  return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);","}","float exponentialInOut(float t) {","  return t == 0.0 || t == 1.0","    ? t","    : t < 0.5","      ? +0.5 * pow(2.0, (20.0 * t) - 10.0)","      : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;","}","float circularIn(float t) {","  return 1.0 - sqrt(1.0 - t * t);","}","float circularOut(float t) {","  return sqrt((2.0 - t) * t);","}","float circularInOut(float t) {","  return t < 0.5","    ? 0.5 * (1.0 - sqrt(1.0 - 4.0 * t * t))","    : 0.5 * (sqrt((3.0 - 2.0 * t) * (2.0 * t - 1.0)) + 1.0);","}","float elasticIn(float t) {","  return sin(13.0 * t * HALF_PI) * pow(2.0, 10.0 * (t - 1.0));","}","float elasticOut(float t) {","  return sin(-13.0 * (t + 1.0) * HALF_PI) * pow(2.0, -10.0 * t) + 1.0;","}","float elasticInOut(float t) {","  return t < 0.5","    ? 0.5 * sin(+13.0 * HALF_PI * 2.0 * t) * pow(2.0, 10.0 * (2.0 * t - 1.0))","    : 0.5 * sin(-13.0 * HALF_PI * ((2.0 * t - 1.0) + 1.0)) * pow(2.0, -10.0 * (2.0 * t - 1.0)) + 1.0;","}","float backIn(float t) {","  return pow(t, 3.0) - t * sin(t * PI);","}","float backOut(float t) {","  float f = 1.0 - t;","  return 1.0 - (pow(f, 3.0) - f * sin(f * PI));","}","float backInOut(float t) {","  float f = t < 0.5","    ? 2.0 * t","    : 1.0 - (2.0 * t - 1.0);","  float g = pow(f, 3.0) - f * sin(f * PI);","  return t < 0.5","    ? 0.5 * g","    : 0.5 * (1.0 - g) + 0.5;","}","float bounceOut(float t) {","  const float a = 4.0 / 11.0;","  const float b = 8.0 / 11.0;","  const float c = 9.0 / 10.0;","  const float ca = 4356.0 / 361.0;","  const float cb = 35442.0 / 1805.0;","  const float cc = 16061.0 / 1805.0;","  float t2 = t * t;","  return t < a","    ? 7.5625 * t2","    : t < b","      ? 9.075 * t2 - 9.9 * t + 3.4","      : t < c","        ? ca * t2 - cb * t + cc","        : 10.8 * t * t - 20.52 * t + 10.72;","}","float bounceIn(float t) {","  return 1.0 - bounceOut(1.0 - t);","}","float bounceInOut(float t) {","  return t < 0.5","    ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))","    : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;","}","float ease(int type, float t) {","  if (t < 0.0) return 0.0;","  else if (t >= 1.0) return 1.0;","","  if (type == QUAD_IN) return easeInQuad(t);","  if (type == QUAD_OUT) return easeOutQuad(t);","  if (type == QUAD_IN_OUT) return easeInOutQuad(t);","  if (type == CUBIC_IN) return cubicIn(t);","  if (type == CUBIC_OUT) return cubicOut(t);","  if (type == CUBIC_IN_OUT) return cubicInOut(t);","  if (type == QUARTIC_IN) return quarticIn(t);","  if (type == QUARTIC_OUT) return quarticOut(t);","  if (type == QUARTIC_IN_OUT) return quarticInOut(t);","  if (type == QINTIC_IN) return qinticIn(t);","  if (type == QINTIC_OUT) return qinticOut(t);","  if (type == QINTIC_IN_OUT) return qinticInOut(t);","  if (type == SINE_IN) return sineIn(t);","  if (type == SINE_OUT) return sineOut(t);","  if (type == SINE_IN_OUT) return sineInOut(t);","  if (type == EXPONENTIAL_IN) return exponentialIn(t);","  if (type == EXPONENTIAL_OUT) return exponentialOut(t);","  if (type == EXPONENTIAL_IN_OUT) return exponentialInOut(t);","  if (type == CIRCULAR_IN) return circularIn(t);","  if (type == CIRCULAR_OUT) return circularOut(t);","  if (type == CIRCULAR_IN_OUT) return circularInOut(t);","  if (type == ELASTIC_IN) return elasticIn(t);","  if (type == ELASTIC_OUT) return elasticOut(t);","  if (type == ELASTIC_IN_OUT) return elasticInOut(t);","  if (type == BACK_IN) return backIn(t);","  if (type == BACK_OUT) return backOut(t);","  if (type == BACK_IN_OUT) return backInOut(t);","  if (type == BOUNCE_OUT) return bounceOut(t);","  if (type == BOUNCE_IN) return bounceIn(t);","  if (type == BOUNCE_IN_OUT) return bounceInOut(t);","  return t;","}"].join("\n"),f=["attribute float startTime;","attribute float endTime;","attribute vec3  positionTo;","uniform   int   positionEasing;","attribute vec3  sizeInfo;","uniform   int   sizeEasing;","attribute vec3  texRotInfo;","uniform   int   texRotEasing;","attribute vec3  redInfo;","uniform   int   redEasing;","attribute vec3  greenInfo;","uniform   int   greenEasing;","attribute vec3  blueInfo;","uniform   int   blueEasing;","attribute vec3  alphaInfo;","uniform   int   alphaEasing;","uniform float now;","varying mat3 vTexRot;","varying float vVisible;","varying vec4 vColor;",e,"void main() {","    float sizeFrom      = sizeInfo[0];","    float sizeTo        = sizeInfo[1];","    float sizeDuration  = sizeInfo[2];","","    float texRotFrom    = texRotInfo[0];","    float texRotTo      = texRotInfo[1];","    float texRotDuration= texRotInfo[2];","","    float redFrom       = redInfo[0];","    float redTo         = redInfo[1];","    float redDuration   = redInfo[2];","","    float greenFrom     = greenInfo[0];","    float greenTo       = greenInfo[1];","    float greenDuration = greenInfo[2];","","    float blueFrom      = blueInfo[0];","    float blueTo        = blueInfo[1];","    float blueDuration  = blueInfo[2];","","    float alphaFrom     = alphaInfo[0];","    float alphaTo       = alphaInfo[1];","    float alphaDuration = alphaInfo[2];","","    float time = (now - startTime) / (endTime - startTime);","    if (time < 0.0 || 1.0 <= time) {","        vVisible = 0.0;","        gl_PointSize = 0.0;","        gl_Position = vec4(0.0);","        return;","    } else {","        vVisible = 1.0;","    }","","    float sizeTime  = (now - startTime) / (sizeDuration * (endTime - startTime));","    float texRotTime= (now - startTime) / (texRotDuration * (endTime - startTime));","    float redTime   = (now - startTime) / (redDuration * (endTime - startTime));","    float greenTime = (now - startTime) / (greenDuration * (endTime - startTime));","    float blueTime  = (now - startTime) / (blueDuration * (endTime - startTime));","    float alphaTime = (now - startTime) / (alphaDuration * (endTime - startTime));","","    float texRot = texRotFrom + (texRotTo - texRotFrom) * ease(texRotEasing, texRotTime);","    vTexRot = mat3(","        1.0, 0.0, 0.0,","        0.0, 1.0, 0.0,","        0.5, 0.5, 1.0","    ) * mat3(","        cos(texRot), sin(texRot), 0.0,","       -sin(texRot), cos(texRot), 0.0,","        0.0, 0.0, 1.0","    ) * mat3(","        1.0, 0.0, 0.0,","        0.0, 1.0, 0.0,","       -0.5,-0.5, 1.0","    );","","    vColor = vec4(","        redFrom   + (redTo   - redFrom)   * ease(redEasing,   redTime),","        greenFrom + (greenTo - greenFrom) * ease(greenEasing, greenTime),","        blueFrom  + (blueTo  - blueFrom)  * ease(blueEasing,  blueTime),","        alphaFrom + (alphaTo - alphaFrom) * ease(alphaEasing, alphaTime)","    );","","    vec4 mvPosition = modelViewMatrix * vec4( position + (positionTo - position) * ease(positionEasing, time), 1.0 );","    float s = sizeFrom + (sizeTo - sizeFrom) * ease(sizeEasing, sizeTime);","    gl_PointSize = s * ( 300.0 / length( mvPosition.xyz ) );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),g=["uniform sampler2D texture;","varying mat3 vTexRot;","varying float vVisible;","varying vec4 vColor;","void main() {","    if (vVisible == 0.0) {","        discard;","    }","    gl_FragColor = texture2D( texture, (vTexRot * vec3(gl_PointCoord, 1.0)).xy ) * vColor;","}"].join("\n");
}();var tm=tm||{};tm.asset=tm.asset||{},function(){tm.asset=tm.asset||{},tm.define("tm.asset.ThreeJSON",{superClass:"tm.event.EventDispatcher",init:function(a){this.superInit(),this.mesh=null,null===tm.asset.ThreeJSON.loader&&(tm.asset.ThreeJSON.loader=new THREE.JSONLoader),tm.asset.ThreeJSON.loader.load(a,function(a,b){this.build(a,b),this.flare("load")}.bind(this))},build:function(a,b){b.forEach(function(a){a.shading=THREE.FlatShading}),this.mesh=new THREE.Mesh(a,new THREE.MeshFaceMaterial(b))}}),tm.asset.ThreeJSON.loader=null,tm.asset.Loader.register("three",function(a){return tm.asset.ThreeJSON(a)})}();var tm=tm||{};tm.asset=tm.asset||{},function(){tm.asset=tm.asset||{},tm.define("tm.asset.Vox",{superClass:"tm.event.EventDispatcher",init:function(a){this.superInit(),this.mesh=null,null===tm.asset.Vox.parser&&(tm.asset.Vox.parser=new vox.Parser),tm.asset.Vox.parser.parse(a).then(function(a){var b=new vox.MeshBuilder(a);this.mesh=b.createMesh(),this.flare("load")}.bind(this))}}),tm.asset.Vox.parser=null,tm.asset.Loader.register("vox",function(a){return tm.asset.Vox(a)})}(),function(){tm.asset=tm.asset||{},_modelPath="",tm.define("tm.asset.MQO",{superClass:"tm.event.EventDispatcher",model:null,init:function(a){this.superInit(),this.loadFromURL(a)},loadFromURL:function(a){var b=a.split("/");_modelPath="";for(var c=0,d=b.length;d-1>c;c++)_modelPath+=b[c];var e=this,f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){var a=f.responseText;e.loadFromData(a)},f.send(null)},loadFromData:function(a){this.model=tm.MQOModel(a),this.flare("load")}}),tm.asset.Loader.register("mqo",function(a){return tm.asset.MQO(a)}),tm.define("tm.MQOModel",{meshes:[],_rawMeshes:[],_rawMaterials:null,init:function(a){this.meshes=[],this._rawMeshes=[],this._rawMaterials=null,this.parse(a),this.convert()},parse:function(a){var b=a.match(/^Material [\s\S]*?^\}/m);this._rawMaterials=tm.MQOMaterial(b[0]);for(var c=a.match(/^Object [\s\S]*?^\}/gm),d=0,e=c.length;e>d;++d){var f=tm.MQOMesh(c[d]);this._rawMeshes.push(f)}},convert:function(){this.meshes=[];for(var a=0,b=this._rawMeshes.length;b>a;a++)for(var c=this._rawMeshes[a],d=c.convert(this._rawMaterials),e=0,f=d.length;f>e;e++)this.meshes.push(d[e])}}),tm.define("tm.MQOMesh",{name:"",vertices:[],faces:[],vertNormals:[],facet:59.5,mirror:0,mirrorAxis:0,init:function(a){this.vertices=[],this.faces=[],this.vertNormals=[],this.parse(a)},parse:function(a){var b=a.split(" ");this.name=b[1].replace(/"/g,"");var c=a.match(/facet ([0-9\.]+)/);c&&(this.facet=Number(c[1]));var d=a.match(/visible ([0-9\.]+)/);d&&(this.visible=Number(d[1]));var e=a.match(/mirror ([0-9])/m);if(e){this.mirror=Number(e[1]);var f=a.match(/mirror_axis ([0-9])/m);f&&(this.mirrorAxis=Number(f[1]))}a.match(/vertex ([0-9]+).+\{\s([\w\W]+)}$/gm);this._parseVertices(RegExp.$1,RegExp.$2);a.match(/face ([0-9]+).+\{\s([\w\W]+)}$/gm);this._parseFaces(RegExp.$1,RegExp.$2)},convert:function(a){if(0==this.visible)return[];var b=[];b[b.length]=this.faces[0].m[0];for(var c=0,d=this.faces.length;d>c;c++){for(var e=this.faces[c].m[0],f=0,g=b.length;g>f;f++)b[f]==this.faces[c].m[0]&&(e=-1);-1!=e&&b.push(e)}for(var h=[],i=0;i<b.length;i++){var j=b[i],k=this.build(j,a.materials[j]);k&&h.push(k)}return h},build:function(a,b){var c=null;if(b){c=void 0===b.shader?new THREE.MeshPhongMaterial:2==b.shader?new THREE.MeshLambertMaterial:3==b.shader?new THREE.MeshPhongMaterial:new THREE.MeshBasicMaterial;var d=b.col[0],e=b.col[1],f=b.col[2];c.color&&c.color.setRGB(d,e,f),c.emissive&&c.emissive.setRGB(d*b.emi*.1,e*b.emi*.1,f*b.emi*.1),c.ambient&&c.ambient.setRGB(d*b.amb,e*b.amb,f*b.amb),c.specular&&c.specular.setRGB(d*b.spc,e*b.spc,f*b.spc),b.tex&&(c.map=THREE.ImageUtils.loadTexture(_modelPath+"/"+b.tex)),c.transparent=!0,c.shiness=b.power,c.opacity=b.col[3]}else c=new THREE.MeshBasicMaterial,c.color.setRGB(.7,.7,.7),c.transparent=!0,c.shiness=1;for(var g=new THREE.Geometry,h=0;h<this.vertices.length;h++)this.vertices[h].to=-1;for(var i=0,h=0,j=this.faces.length;j>h;h++){var k=this.faces[h];if(k.m==a&&!(k.vNum<3)){var l=k.v;if(3==k.vNum){var m=k.n[0],n=k.n[1],o=k.n[2],p=new THREE.Vector3(m,n,o),q=[];q[0]=l[2],q[1]=l[1],q[2]=l[0];for(var r=0;3>r;r++){var s=this.vertices[q[r]];-1!=s.to?q[r]=s.to:(s.to=i,q[r]=s.to,i++)}var t=new THREE.Face3(q[0],q[1],q[2],p,void 0,k.m[0]);t.vertexNormals.push(p),t.vertexNormals.push(p),t.vertexNormals.push(p),g.faces.push(t),g.faceVertexUvs[0].push([new THREE.Vector2(k.uv[4],1-k.uv[5]),new THREE.Vector2(k.uv[2],1-k.uv[3]),new THREE.Vector2(k.uv[0],1-k.uv[1])])}else if(4==k.vNum){var m=k.n[0],n=k.n[1],o=k.n[2],p=new THREE.Vector3(m,n,o),q=[];q[0]=l[3],q[1]=l[2],q[2]=l[1];for(var r=0;3>r;r++){var s=this.vertices[q[r]];-1!=s.to?q[r]=s.to:(s.to=i,q[r]=s.to,i++)}var t=new THREE.Face3(q[0],q[1],q[2],p,void 0,k.m[0]);t.vertexNormals.push(p),t.vertexNormals.push(p),t.vertexNormals.push(p),g.faces.push(t),g.faceVertexUvs[0].push([new THREE.Vector2(k.uv[6],1-k.uv[7]),new THREE.Vector2(k.uv[4],1-k.uv[5]),new THREE.Vector2(k.uv[2],1-k.uv[3])]);var q=[];q[0]=l[1],q[1]=l[0],q[2]=l[3];for(var r=0;3>r;r++){var s=this.vertices[q[r]];-1!=s.to?q[r]=s.to:(s.to=i,q[r]=s.to,i++)}var t=new THREE.Face3(q[0],q[1],q[2],p,void 0,k.m[0]);t.vertexNormals.push(p),t.vertexNormals.push(p),t.vertexNormals.push(p),g.faces.push(t),g.faceVertexUvs[0].push([new THREE.Vector2(k.uv[2],1-k.uv[3]),new THREE.Vector2(k.uv[0],1-k.uv[1]),new THREE.Vector2(k.uv[6],1-k.uv[7])])}}}var u=1;this.vertices.sort(function(a,b){return a.to-b.to});for(var h=0;h<this.vertices.length;h++){var s=this.vertices[h];if(-1!=s.to){var v=s.x*u,w=s.y*u,x=s.z*u;g.vertices.push(new THREE.Vector3(v,w,x))}}g.computeBoundingBox(),g.computeFaceNormals(),g.computeVertexNormals();var y=new THREE.Mesh(g,c);return y},_parseVertices:function(a,b){for(var c=.1,d=b.split("\n"),e=0;a>=e;e++){var f=d[e].split(" ");if(!(f.length<3)){var g={};g.x=Number(f[0])*c,g.y=Number(f[1])*c,g.z=Number(f[2])*c,this.vertices.push(g)}}if(this.mirror)for(var h=this,i=function(){return{1:function(a){return[-1*a[0],a[1],a[2]]},2:function(a){return[a[0],-1*a[1],a[2]]},4:function(a){return[a[0],a[1],-1*a[2]]}}[h.mirrorAxis]}(),j=this.vertices.length,e=0;j>e;e++)this.vertices.push(i(this.vertices[e]))},_parseFaces:function(a,b){for(var c=b.split("\n"),d=function(a,b,c){var d=[a[0]-b[0],a[1]-b[1],a[2]-b[2]],e=[c[0]-b[0],c[1]-b[1],c[2]-b[2]],f=[d[1]*e[2]-d[2]*e[1],d[2]*e[0]-d[0]*e[2],d[0]*e[1]-d[1]*e[0]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);return f[0]/=g,f[1]/=g,f[2]/=g,f},e=0;a>=e;e++){var f=c[e].replace(/^\s+|\s+$/g,""),g=Number(f[0]),h=f.match(/([A-Za-z]+)\(([\w\s\-\.\(\)]+?)\)/gi),i={vNum:g};if(h){for(var j=0,k=h.length;k>j;j++){var l=h[j].match(/([A-Za-z]+)\(([\w\s\-\.\(\)]+?)\)/),m=l[1].toLowerCase(),n=l[2].split(" ");n.forEach(function(a,b,c){c[b]=Number(a)}),i[m]=n}i.uv||(i.uv=[0,0,0,0,0,0,0,0]),i.m||(i.m=[void 0]),i.v.length>2&&(i.n=d(this.vertices[i.v[0]],this.vertices[i.v[1]],this.vertices[i.v[2]])),this.faces.push(i)}}if(this.mirror)for(var o=function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this},k=this.faces.length,p=this.vertices.length/2,e=0;k>e;e++){for(var q=this.faces[e],i={uv:[],v:[],vNum:q.vNum},j=0;j<q.v.length;j++)i.v[j]=q.v[j]+p;for(var j=0;j<q.uv.length;j++)i.uv[j]=q.uv[j];3==i.vNum?o.call(i.v,1,2):(o.call(i.v,0,1),o.call(i.v,2,3)),i.n=q.n,i.m=q.m,this.faces.push(i)}for(var r=Array(this.vertices.length),e=0,k=this.vertices.length;k>e;e++)r[e]=[];for(var e=0;e<this.faces.length;e++)for(var i=this.faces[e],s=i.v,j=0;j<i.vNum;j++){var t=s[j];r[t].push.apply(r[t],i.n)}for(var e=0;e<r.length;e++){for(var u=r[e],v=[0,0,0],k=u.length/3,j=0;k>j;j++)v[0]+=u[3*j+0],v[1]+=u[3*j+1],v[2]+=u[3*j+2];v[0]/=k,v[1]/=k,v[2]/=k;var k=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);v[0]/=k,v[1]/=k,v[2]/=k,this.vertNormals[e]=v}}}),tm.define("tm.MQOMaterial",{materials:[],init:function(a){this.materials=[],this.parse(a)},parse:function(a){for(var b=a.split("\n"),c=1,d=b.length-1;d>c;c++){var e={},f=b[c].replace(/^\s+|\s+$/g,""),g=f.match(/([A-Za-z]+)\(([\w\W]+?)\)/gi),h=f.split(" ");e.name=h[0].replace(/"/g,"");for(var i=0,j=g.length;j>i;i++){var k=g[i].match(/([A-Za-z]+)\(([\w\W]+?)\)/),l=k[1].toLowerCase(),m=null;"tex"!=l&&"aplane"!=l?(m=k[2].split(" "),m.forEach(function(a,b,c){c[b]=Number(a)})):m=k[2].replace(/"/g,""),e[l]=m}this.materials.push(e)}},convert:function(){}})}();